<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitcamp.web.mapper.Mapper">
   <update id="updateMember" parameterType="com.bitcamp.web.domain.MemberDTO">
   UPDATE ${type}
   <set><!-- if앞에는 컬럼 값이다. -->
   		<!-- if는 화면에서 던진 값이다. -->
   		<if test="pass != null">
   		pass = #{pass},
   		</if>
   		<if test="phone != null">
   		phone = #{phone},
   		</if>
   		<if test="email != null">
   		email = #{email},
   		</if>
   		<if test="profile != null">
   		profile = #{profile},
   		</if>
   		<if test="addr != null">
   		addr = #{addr}
   		</if>
   </set>
   	WHERE ${column} = #{data}
   </update>
   <resultMap type="com.bitcamp.web.domain.MemberDTO" id="member">
   <id property="id" column="id"/>
   <result property="pass" column="pass"/>
   <result property="name" column="name"/>
   <result property="ssn" column="ssn"/>
   <result property="phone" column="phone"/>
   <result property="email" column="email"/>
   <result property="profile" column="profile"/>
   <result property="addr" column="addr"/>
   </resultMap>
    <resultMap type="com.bitcamp.web.domain.AdminDTO" id="admin">
   <id property="adminID" column="admin_id"/>
   <result property="Adminpass" column="admin_pass"/>
   </resultMap>
    <select id="searchMemberById" resultMap="member" parameterType="hashMap">
    	SELECT * FROM ${type}
    	WHERE ${id} LIKE #{content}
    
    </select>
    <select id="selectByKeyword" resultMap="member" parameterType="hashMap">
    	SELECT * FROM ${type}
    	WHERE 
    	<if test="name != null">
    	name = #{data}
    	</if>
    	<if test="ssn != null">
    		and ssn = #{data}
    	</if>
    	<if test="phone != null">
    		and phone = #{data}
    	</if>
    	<if test="email != null">
    		and email = #{data}
    	</if>
    	<if test="profile != null">
    		and profile = #{data}
    	</if>
    		<if test="addr != null">
    		and addr = #{data}
    	</if>
    	${name} LIKE #{data}
    
    </select>
    
    
     <insert id="insertMember" parameterType="com.bitcamp.web.domain.Command" >
     INSERT INTO MEMBER VALUES (#{member.id},#{member.pass},#{member.name},
     <choose>
        <when test="member.ssn == null">
            ''
        </when>
        <otherwise>
            #{member.ssn}
        </otherwise>
    </choose>,
    <choose>
        <when test="member.phone == null">
            ''
        </when>
        <otherwise>
            #{member.phone}
        </otherwise>
    </choose>,
    <choose>
        <when test="member.email == null">
            ''
        </when>
        <otherwise>
            #{member.email}
        </otherwise>
    </choose>,
    <choose>
        <when test="member.profile == null">
            ''
        </when>
        <otherwise>
            #{member.profile}
        </otherwise>
    </choose>,
    <choose>
        <when test="member.addr == null">
            ''
        </when>
        <otherwise>
            #{member.addr}
        </otherwise>
    </choose>)
     </insert>
     <select id="articles" resultType="com.bitcamp.web.domain.BoardDTO" parameterType="com.bitcamp.web.domain.Command">
     	select A2.* from(
		select @rank:=@rank+1 rank, A.* 
		    from(select 
		            bbs_Seq as bbsSeq,
		            title,
		            content,
		            regdate,
		            id 
		                from board 
		                    order by bbsSeq desc
        		) A,(SELECT @rank := 0) R) A2
				where rank between #{paging.startRow} and #{paging.endRow};
     </select>
     <select id="selectMemberById" resultType="com.bitcamp.web.domain.MemberDTO" parameterType="com.bitcamp.web.domain.Command">
     SELECT * FROM MEMBER WHERE ID LIKE #{data1}
     </select>
     <select id="exist" resultType="int" parameterType="com.bitcamp.web.domain.Command">
     SELECT COUNT(*) FROM ${type} WHERE ${id} LIKE #{data1} AND ${pass} LIKE #{data2}
     
     </select>
     <select id="selectCount" resultType="int" parameterType="com.bitcamp.web.domain.Command">
     SELECT COUNT(*) FROM board
     </select>
     <insert id="addImage"  parameterType="com.bitcamp.web.domain.ImageDTO">
     	INSERT INTO Image
     	VALUES (#{imageID},#{fileName},#{extension},now()}
     </insert>
     <delete id="deleteMember" parameterType="com.bitcamp.web.domain.Command"></delete>
     <select id="selectAdminById" resultType="com.bitcamp.web.domain.AdminDTO" parameterType="com.bitcamp.web.domain.Command">
     SELECT admin_id as adminID FROM ADMIN WHERE admin_id LIKE #{data1}
     </select>
</mapper>